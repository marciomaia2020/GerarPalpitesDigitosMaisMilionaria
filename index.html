<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>+Milion√°ria - Gerador de Palpites Avan√ßado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        milionaria: '#31357C',
                        'milionaria-light': '#4a4e95',
                        'milionaria-dark': '#252862',
                        'milionaria-bg': '#f7f8ff'
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .loading-circle {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #31357C, #4a4e95, #252862);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .numero-milionaria {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #31357C, #4a4e95);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            margin: 1px;
        }
        
        .numero-milionaria:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(49, 53, 124, 0.4);
        }
        
        .numero-milionaria.selecionado {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.3);
            border-color: #dc2626;
        }

        .numero-milionaria.sorteado {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: 2px solid #fbbf24;
            position: relative;
        }

        .numero-milionaria.sorteado::after {
            content: "üíé";
            position: absolute;
            top: -6px;
            right: -6px;
            font-size: 10px;
            background: #fbbf24;
            color: #333;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .numero-milionaria.sorteado.disabled {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            opacity: 0.4;
            cursor: not-allowed;
        }

        .numero-milionaria.sorteado.disabled::after {
            background: #9ca3af;
        }

        .trevo-milionaria {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            margin: 2px;
        }
        
        .trevo-milionaria:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }
        
        .trevo-milionaria.selecionado {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.3);
            border-color: #dc2626;
        }

        .trevo-milionaria.sorteado {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: 2px solid #fbbf24;
            position: relative;
        }

        .trevo-milionaria.sorteado::after {
            content: "üçÄ";
            position: absolute;
            top: -6px;
            right: -6px;
            font-size: 10px;
            background: #fbbf24;
            color: #333;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .trevo-milionaria.sorteado.disabled {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            opacity: 0.4;
            cursor: not-allowed;
        }

        .trevo-milionaria.sorteado.disabled::after {
            background: #9ca3af;
        }
        
        .numero-milionaria.disabled, .trevo-milionaria.disabled {
            background: #9ca3af;
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .jogo-card {
            background: linear-gradient(to right, #f7f8ff, #f1f3ff);
            border: 2px solid #31357C;
            border-radius: 12px;
            padding: 16px;
            margin: 8px 0;
        }
        
        .numero-jogo {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #31357C, #4a4e95);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }

        .trevo-jogo {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }
        
        .custo-total {
            background: linear-gradient(45deg, #31357C, #252862);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 18px;
        }

        .digito-badge {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
        }

        .numero-resultado {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #31357C, #4a4e95);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            margin: 2px;
        }

        .trevo-resultado {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            margin: 2px;
        }
    </style>
</head>
<body class="bg-milionaria-bg min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-4xl font-bold text-milionaria mb-2">üíé +MILION√ÅRIA</h1>
            <p class="text-gray-600">Gerador de Palpites com An√°lise Estat√≠stica</p>
        </div>

        <!-- Loading -->
        <div id="loading" class="text-center py-8">
            <div class="loading-circle mx-auto mb-4"></div>
            <p class="text-milionaria font-medium">Carregando √∫ltimo resultado...</p>
        </div>

        <!-- √öltimo Resultado -->
        <div id="ultimoResultado" class="hidden mb-6">
            <div class="bg-white rounded-lg shadow-lg overflow-hidden border-2 border-milionaria">
                <div class="bg-milionaria text-white p-4 text-center">
                    <h2 id="tituloResultado" class="text-xl font-bold">Concurso 276</h2>
                    <div id="dataResultado" class="text-sm">üìÖ 11/08/2025 (Quinta)</div>
                </div>
                
                <div class="p-6 text-center">
                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-milionaria mb-3">N√∫meros Sorteados</h3>
                        <div id="numerosResultado" class="flex flex-wrap justify-center gap-1 mb-4">
                            <!-- N√∫meros sorteados ser√£o inseridos aqui -->
                        </div>
                    </div>

                    <div class="mb-4">
                        <h3 class="text-lg font-bold text-green-600 mb-3">Trevos da Sorte</h3>
                        <div id="trevosResultado" class="flex justify-center gap-2 mb-4">
                            <!-- Trevos sorteados ser√£o inseridos aqui -->
                        </div>
                    </div>
                    
                    <div id="statusResultado" class="text-lg font-bold mb-4 text-red-600">
                        ACUMULOU!
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs">
                        <div class="flex items-center justify-center">
                            <span class="text-milionaria mr-1">üèÜ</span>
                            <span>5 acertos + 1 trevo: 1 ganhador - R$ 68.119</span>
                        </div>
                        <div class="flex items-center justify-center">
                            <span class="text-milionaria mr-1">üèÜ</span>
                            <span>4 acertos + 2 trevos: 348 ganhadores - R$ 1.539,76</span>
                        </div>
                        <div class="flex items-center justify-center">
                            <span class="text-milionaria mr-1">üèÜ</span>
                            <span>4 acertos + 1 trevo: 2321 ganhadores - R$ 85,09</span>
                        </div>
                        <div class="flex items-center justify-center">
                            <span class="text-milionaria mr-1">üèÜ</span>
                            <span>3 acertos + 2 trevos: 18534 ganhadores - R$ 50,00</span>
                        </div>
                    </div>
                    
                    <div class="mt-4 text-center">
                        <div class="text-sm text-gray-600">Pr√≥ximo Sorteio: Concurso 277</div>
                        <div class="text-sm text-gray-600">14/08/2025 (S√°bado)</div>
                        <div class="text-2xl font-bold text-milionaria mt-2">
                            Pr√™mio Estimado: R$ 163.000.000,00
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interface Principal - Dividida em 2 Colunas -->
        <div id="interfacePrincipal" class="hidden grid grid-cols-1 xl:grid-cols-2 gap-6">
            
            <!-- LADO ESQUERDO: Cria√ß√£o de Jogos -->
            <div class="space-y-6">
                <!-- Controles do Jogo -->
                <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-milionaria">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-milionaria">üéÆ Criar Novo Jogo</h3>
                        <button id="comoFuncionaBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm">
                            ‚ùì Como Funciona
                        </button>
                    </div>
                    
                    <!-- Informa√ß√£o do Jogo -->
                    <div class="mb-4 p-3 bg-purple-50 border border-purple-200 rounded-lg">
                        <div class="text-sm font-medium text-purple-800 mb-2">üíé Regras da +Milion√°ria:</div>
                        <div class="text-xs text-purple-700">
                            Selecione <strong>6 n√∫meros</strong> de 01 a 50 + <strong>2 trevos</strong> de 1 a 6.
                            Custo: <strong>R$ 6,00</strong> por jogo.
                        </div>
                    </div>

                    <!-- Controle de N√∫meros Sorteados -->
                    <div id="controleNumerosSorteados" class="mb-4 p-3 bg-orange-50 border border-orange-200 rounded-lg hidden">
                        <div class="flex justify-between items-center mb-2">
                            <div class="text-sm font-medium text-orange-800">
                                üíé √öltimo sorteio: <span id="numerosSorteadosLista" class="font-bold"></span>
                            </div>
                            <label class="flex items-center text-sm">
                                <input type="checkbox" id="permitirNumerosSorteados" class="mr-2">
                                <span class="text-orange-700">Permitir usar n√∫meros/trevos j√° sorteados</span>
                            </label>
                        </div>
                        <div class="text-xs text-orange-600">
                            Por padr√£o, n√∫meros e trevos que sa√≠ram no √∫ltimo concurso est√£o <strong>desabilitados</strong> para evitar repeti√ß√µes.
                        </div>
                    </div>

                    <!-- An√°lise do Jogo Atual -->
                    <div id="analiseJogo" class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <div class="text-sm font-medium text-blue-800 mb-2">üìä Status do Jogo:</div>
                        <div class="grid grid-cols-2 gap-2 text-xs">
                            <div>N√∫meros: <span id="numerosCount" class="font-bold">0/6</span></div>
                            <div>Trevos: <span id="trevosCount" class="font-bold">0/2</span></div>
                        </div>
                        <div class="text-xs mt-1">
                            D√≠gitos √∫nicos: <span id="digitosCount" class="font-bold">0</span>
                        </div>
                        <div id="sugestaoDigitos" class="mt-2 text-xs text-blue-700">
                            <!-- Sugest√£o baseada no √∫ltimo sorteio -->
                        </div>
                    </div>

                    <!-- Grid de N√∫meros 1-50 -->
                    <div class="mb-4">
                        <label class="block text-milionaria font-medium mb-3">Selecione 6 N√∫meros (01-50):</label>
                        <div id="gridNumeros" class="grid grid-cols-7 gap-1 max-h-64 overflow-y-auto">
                            <!-- N√∫meros de 01 a 50 ser√£o gerados aqui -->
                        </div>
                    </div>

                    <!-- Grid de Trevos 1-6 -->
                    <div class="mb-4">
                        <label class="block text-green-600 font-medium mb-3">üçÄ Selecione 2 Trevos (1-6):</label>
                        <div id="gridTrevos" class="flex justify-center gap-2">
                            <!-- Trevos de 1 a 6 ser√£o gerados aqui -->
                        </div>
                    </div>

                    <!-- Bot√µes de A√ß√£o -->
                    <div class="flex flex-wrap gap-2">
                        <button id="limparJogo" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                            üóëÔ∏è Limpar
                        </button>
                        <button id="randomizarJogo" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg">
                            üé≤ Aleat√≥rio
                        </button>
                        <button id="adicionarJogo" class="bg-milionaria hover:bg-milionaria-dark text-white px-4 py-2 rounded-lg disabled:opacity-50">
                            ‚ûï Adicionar Jogo
                        </button>
                    </div>
                </div>

                <!-- Tabela de Probabilidades -->
                <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-blue-200">
                    <h3 class="text-lg font-bold text-blue-800 mb-4">üìä Probabilidades de Acerto</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-xs">
                            <thead class="bg-blue-100">
                                <tr>
                                    <th class="p-2 text-left">Acertos</th>
                                    <th class="p-2 text-right">Probabilidade</th>
                                    <th class="p-2 text-right">1 em X</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td class="p-1">6 + 2 trevos</td><td class="p-1 text-right">0,0000005%</td><td class="p-1 text-right">238.360.500</td></tr>
                                <tr class="bg-gray-50"><td class="p-1">6 + 1 trevo</td><td class="p-1 text-right">0,000002%</td><td class="p-1 text-right">59.590.125</td></tr>
                                <tr><td class="p-1">6 + 0 trevos</td><td class="p-1 text-right">0,000003%</td><td class="p-1 text-right">39.726.750</td></tr>
                                <tr class="bg-gray-50"><td class="p-1">5 + 2 trevos</td><td class="p-1 text-right">0,00003%</td><td class="p-1 text-right">3.972.675</td></tr>
                                <tr><td class="p-1">5 + 1 trevo</td><td class="p-1 text-right">0,0001%</td><td class="p-1 text-right">993.169</td></tr>
                                <tr class="bg-yellow-50"><td class="p-1">2 + 1 trevo</td><td class="p-1 text-right">11,5%</td><td class="p-1 text-right">44</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-3 text-xs text-blue-600">
                        üíé <strong>+Milion√°ria:</strong> Pr√™mio m√≠nimo de R$ 10 milh√µes!
                    </div>
                </div>
            </div>

            <!-- LADO DIREITO: Visualiza√ß√£o dos Jogos -->
            <div class="space-y-6">
                <!-- Resumo e Controles -->
                <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-milionaria">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-milionaria">üìã Meus Jogos</h3>
                        <div class="flex items-center gap-2">
                            <label class="flex items-center text-sm">
                                <input type="checkbox" id="mostrarOrdemCrescente" class="mr-2" checked>
                                üî¢ Ordem Crescente
                            </label>
                        </div>
                    </div>

                    <!-- Custo Total -->
                    <div class="mb-4">
                        <div class="custo-total text-center">
                            üí∞ Total: <span id="custoTotal">R$ 0,00</span>
                        </div>
                        <div class="text-center text-sm text-gray-600 mt-2">
                            <span id="totalJogos">0</span> jogo(s) adicionado(s)
                        </div>
                    </div>

                    <!-- Bot√µes de Download -->
                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <button id="downloadHTML" class="bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 rounded-lg text-sm">
                            üåê HTML
                        </button>
                        <button id="downloadTXT" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm" title="TXT: Agora minimalista - s√≥ n√∫meros!">
                            üìÑ TXT
                        </button>
                        <button id="downloadXLSX" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm">
                            üìä XLSX
                        </button>
                    </div>

                    <!-- Bot√£o Limpar Todos -->
                    <button id="limparTodos" class="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg">
                        üóëÔ∏è Limpar Todos os Jogos
                    </button>
                </div>

                <!-- Lista dos Jogos -->
                <div class="bg-white rounded-lg shadow-lg p-6 border-2 border-gray-200 max-h-96 overflow-y-auto">
                    <h4 class="font-bold text-gray-800 mb-4">Lista de Jogos:</h4>
                    <div id="listaJogos">
                        <p class="text-gray-500 text-center py-8">Nenhum jogo adicionado ainda</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Como Funciona -->
        <div id="modalComoFunciona" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-lg max-w-4xl w-full mx-4 max-h-screen overflow-y-auto">
                <div class="bg-milionaria text-white p-6 rounded-t-lg">
                    <h2 class="text-2xl font-bold text-center">üíé Como Funciona a +Milion√°ria</h2>
                </div>
                
                <div class="p-6 space-y-6">
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                        <h3 class="text-xl font-bold text-purple-800 mb-3">üìã Passo a Passo:</h3>
                        <div class="space-y-3 text-purple-700">
                            <p><strong>1. Dupla sele√ß√£o:</strong> 6 n√∫meros (01-50) + 2 trevos (1-6)</p>
                            <p><strong>2. N√∫meros principais:</strong> Escolha 6 n√∫meros de 01 a 50</p>
                            <p><strong>3. Trevos da sorte:</strong> Escolha 2 trevos de 1 a 6</p>
                            <p><strong>4. Sistema complexo:</strong> 10 faixas de premia√ß√£o diferentes</p>
                            <p><strong>5. Pr√™mio m√≠nimo:</strong> R$ 10 milh√µes garantidos</p>
                            <p><strong>6. Download:</strong> Exporte seus jogos em HTML, TXT ou XLSX</p>
                        </div>
                    </div>

                    <!-- Controle de N√∫meros Sorteados -->
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                        <h3 class="text-xl font-bold text-orange-800 mb-3">üíé Controle de N√∫meros e Trevos Sorteados:</h3>
                        <div class="space-y-2 text-orange-700">
                            <p><strong>Bloqueio duplo:</strong> N√∫meros E trevos do √∫ltimo concurso ficam desabilitados por padr√£o</p>
                            <p><strong>Visual especial:</strong> N√∫meros sorteados t√™m √≠cone üíé e trevos sorteados t√™m √≠cone üçÄ</p>
                            <p><strong>Estrat√©gia anti-repeti√ß√£o:</strong> Evita usar exatamente os mesmos n√∫meros e trevos</p>
                            <p><strong>Flexibilidade:</strong> Marque "Permitir n√∫meros/trevos sorteados" para habilit√°-los</p>
                            <p><strong>Gera√ß√£o inteligente:</strong> Randomiza√ß√£o respeitar√° sua prefer√™ncia automaticamente</p>
                            <p><strong>Sistema √∫nico:</strong> Primeira loteria brasileira com duplo bloqueio (n√∫meros + trevos)</p>
                        </div>
                    </div>

                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h3 class="text-xl font-bold text-green-800 mb-3">üçÄ Trevos da Sorte:</h3>
                        <div class="space-y-2 text-green-700">
                            <p><strong>Elemento √∫nico:</strong> Apenas 6 op√ß√µes (1, 2, 3, 4, 5, 6)</p>
                            <p><strong>Obrigat√≥rios:</strong> Voc√™ deve escolher exatamente 2 trevos</p>
                            <p><strong>Combina√ß√µes:</strong> Com n√∫meros geram 10 faixas de pr√™mio</p>
                            <p><strong>Estrat√©gia:</strong> Trevos s√£o mais f√°ceis de acertar que n√∫meros</p>
                            <p><strong>Impacto:</strong> Determinam o valor do pr√™mio junto com n√∫meros</p>
                        </div>
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 class="text-xl font-bold text-blue-800 mb-3">üéØ An√°lise de D√≠gitos:</h3>
                        <div class="space-y-2 text-blue-700">
                            <p><strong>Como contamos:</strong> Todos os d√≠gitos √∫nicos (0-9) que aparecem nos n√∫meros</p>
                            <p><strong>Exemplo:</strong> 05 12 27 34 45 = d√≠gitos 0, 1, 2, 3, 4, 5, 7 = 7 d√≠gitos diferentes</p>
                            <p><strong>Range m√©dio:</strong> Com 50 n√∫meros, equil√≠brio entre facilidade e variedade</p>
                            <p><strong>Sugest√£o:</strong> √öltimo sorteio usou X d√≠gitos ‚Üí tente algo similar</p>
                        </div>
                    </div>

                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h3 class="text-xl font-bold text-yellow-800 mb-3">üí∞ Sistema de Premia√ß√£o:</h3>
                        <div class="space-y-3">
                            <div class="bg-white p-3 rounded border border-yellow-300">
                                <div class="text-sm font-medium text-yellow-800 mb-2">üèÜ 10 Faixas de Premia√ß√£o:</div>
                                <div class="grid grid-cols-1 gap-1 text-xs text-yellow-700">
                                    <div><strong>6 + 2 trevos:</strong> Pr√™mio m√°ximo (m√≠nimo R$ 10 milh√µes)</div>
                                    <div><strong>6 + 1 trevo:</strong> Segundo maior pr√™mio</div>
                                    <div><strong>6 + 0 trevos:</strong> Terceiro maior pr√™mio</div>
                                    <div><strong>5 + 2 trevos:</strong> Quarto maior pr√™mio</div>
                                    <div><strong>(...)</strong> at√© <strong>2 + 1 trevo:</strong> Menor pr√™mio</div>
                                </div>
                            </div>
                            
                            <div class="text-sm">
                                <div><strong>Valor da aposta:</strong> R$ 6,00 (fixo)</div>
                                <div><strong>Desenhos:</strong> Quarta e S√°bado</div>
                                <div><strong>Maior diferencial:</strong> Pr√™mio m√≠nimo garantido de R$ 10 milh√µes!</div>
                            </div>
                            
                            <div class="text-xs text-yellow-600">
                                üíé <strong>Dica:</strong> Distribua n√∫meros entre as faixas (1-12, 13-25, 26-37, 38-50)!
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-50 px-6 py-4 rounded-b-lg text-center">
                    <button id="fecharModal" class="bg-milionaria hover:bg-milionaria-dark text-white font-medium py-2 px-6 rounded-lg">
                        ‚úÖ Entendi, Vamos Jogar!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let ultimoResultado = null;
        let jogosAdicionados = [];
        let numerosSelecionados = [];
        let trevosSelecionados = [];
        let numerosSorteados = new Set(); // N√∫meros do √∫ltimo sorteio
        let trevosSorteados = new Set(); // Trevos do √∫ltimo sorteio
        const quantidadeNumeros = 6; // +Milion√°ria tem 6 n√∫meros
        const quantidadeTrevos = 2; // +Milion√°ria tem 2 trevos
        const custoJogo = 6.00; // +Milion√°ria custa R$ 6,00

        // Inicializa√ß√£o da aplica√ß√£o
        document.addEventListener('DOMContentLoaded', async () => {
            await carregarUltimoResultado();
            inicializarInterface();
            configurarEventListeners();
        });

        // Carregar √∫ltimo resultado da +Milion√°ria
        async function carregarUltimoResultado() {
            try {
                const response = await fetch('https://servicebus2.caixa.gov.br/portaldeloterias/api/maismilionaria');
                const data = await response.json();
                ultimoResultado = data;
                exibirUltimoResultado(data);
            } catch (error) {
                console.error('Erro ao carregar resultado:', error);
                // Usar dados de exemplo se a API falhar
                const dadosExemplo = {
                    numero: 276,
                    dataApuracao: "11/08/2025",
                    dataProximoConcurso: "14/08/2025",
                    listaDezenas: ["09", "18", "25", "29", "33", "38"],
                    trevosSorteados: ["3", "6"],
                    acumulado: true,
                    valorEstimadoProximoConcurso: 163000000.00,
                    listaRateioPremio: [
                        { descricaoFaixa: "5 acertos + 1 ou nenhum trevo", numeroDeGanhadores: 1, valorPremio: 68119 },
                        { descricaoFaixa: "4 acertos + 2 trevos", numeroDeGanhadores: 348, valorPremio: 1539.76 },
                        { descricaoFaixa: "4 acertos + 1 ou nenhum trevo", numeroDeGanhadores: 2321, valorPremio: 85.09 },
                        { descricaoFaixa: "3 acertos + 2 trevos", numeroDeGanhadores: 18534, valorPremio: 50.00 }
                    ]
                };
                exibirUltimoResultado(dadosExemplo);
            } finally {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('ultimoResultado').classList.remove('hidden');
                document.getElementById('interfacePrincipal').classList.remove('hidden');
            }
        }

        // Exibir √∫ltimo resultado
        function exibirUltimoResultado(data) {
            document.getElementById('tituloResultado').textContent = `Concurso ${data.numero}`;
            document.getElementById('dataResultado').textContent = `üìÖ ${data.dataApuracao} (Quinta)`;

            // N√∫meros sorteados
            const numerosDiv = document.getElementById('numerosResultado');
            numerosDiv.innerHTML = '';
            const numerosSorteio = data.listaDezenas || data.dezenasSorteadasOrdemSorteio || [];
            
            numerosSorteio.forEach(num => {
                const numeroEl = document.createElement('div');
                numeroEl.className = 'numero-resultado';
                numeroEl.textContent = num;
                numerosDiv.appendChild(numeroEl);
            });

            // Trevos sorteados
            const trevosDiv = document.getElementById('trevosResultado');
            trevosDiv.innerHTML = '';
            const trevosSorteio = data.trevosSorteados || [];
            
            trevosSorteio.forEach(trevo => {
                const trevoEl = document.createElement('div');
                trevoEl.className = 'trevo-resultado';
                trevoEl.textContent = trevo;
                trevosDiv.appendChild(trevoEl);
            });

            // Identificar n√∫meros e trevos sorteados para bloqueio
            identificarNumerosTrevosSorteados(numerosSorteio, trevosSorteio);

            // Status do concurso
            document.getElementById('statusResultado').textContent = data.acumulado ? 'ACUMULOU!' : 'TEVE GANHADOR!';

            // Pr√≥ximo concurso
            document.querySelector('.text-2xl.font-bold.text-milionaria').textContent = 
                `Pr√™mio Estimado: ${formatarMoeda(data.valorEstimadoProximoConcurso || 163000000)}`;

            // Analisar d√≠gitos do √∫ltimo sorteio para sugest√µes
            analisarDigitosUltimoSorteio(numerosSorteio);
        }

        // Identificar n√∫meros e trevos sorteados para bloqueio
        function identificarNumerosTrevosSorteados(numeros, trevos) {
            numerosSorteados.clear();
            trevosSorteados.clear();
            
            numeros.forEach(num => {
                numerosSorteados.add(parseInt(num));
            });
            
            trevos.forEach(trevo => {
                trevosSorteados.add(parseInt(trevo));
            });
            
            // Exibir controle se h√° n√∫meros ou trevos sorteados
            if (numerosSorteados.size > 0 || trevosSorteados.size > 0) {
                exibirControleNumerosSorteados();
            }
        }

        // Exibir controle de n√∫meros sorteados
        function exibirControleNumerosSorteados() {
            const controle = document.getElementById('controleNumerosSorteados');
            const lista = document.getElementById('numerosSorteadosLista');
            
            const numerosArray = Array.from(numerosSorteados).sort((a, b) => a - b);
            const trevosArray = Array.from(trevosSorteados).sort((a, b) => a - b);
            
            let texto = '';
            if (numerosArray.length > 0) {
                texto += `N√∫meros: ${numerosArray.map(n => n.toString().padStart(2, '0')).join(', ')}`;
            }
            if (trevosArray.length > 0) {
                if (texto) texto += ' | ';
                texto += `Trevos: ${trevosArray.join(', ')}`;
            }
            
            lista.textContent = texto;
            controle.classList.remove('hidden');
        }

        // Analisar d√≠gitos do √∫ltimo sorteio
        function analisarDigitosUltimoSorteio(numeros) {
            const digitos = new Set();
            numeros.forEach(num => {
                const numStr = num.toString().padStart(2, '0');
                // Adicionar cada d√≠gito individual
                for (let digit of numStr) {
                    digitos.add(parseInt(digit));
                }
            });
            
            window.digitosUltimoSorteio = digitos.size;
            console.log(`√öltimo sorteio: ${numeros.join(' ')} = ${digitos.size} d√≠gitos: ${Array.from(digitos).sort().join(' ')}`);
            atualizarSugestaoDigitos();
        }

        // Inicializar interface
        function inicializarInterface() {
            criarGridNumeros();
            criarGridTrevos();
            atualizarAnaliseJogo();
        }

        // Criar grid de n√∫meros 1-50
        function criarGridNumeros() {
            const grid = document.getElementById('gridNumeros');
            grid.innerHTML = '';
            
            for (let i = 1; i <= 50; i++) {
                const btn = document.createElement('button');
                btn.className = 'numero-milionaria';
                btn.textContent = i.toString().padStart(2, '0');
                btn.onclick = () => toggleNumero(i);
                
                // Aplicar classe de n√∫mero sorteado se necess√°rio
                if (numerosSorteados.has(i)) {
                    btn.classList.add('sorteado');
                }
                
                grid.appendChild(btn);
            }
            
            // Atualizar estado inicial
            atualizarEstadoNumerosSorteados();
        }

        // Criar grid de trevos 1-6
        function criarGridTrevos() {
            const grid = document.getElementById('gridTrevos');
            grid.innerHTML = '';
            
            for (let i = 1; i <= 6; i++) {
                const btn = document.createElement('button');
                btn.className = 'trevo-milionaria';
                btn.textContent = i;
                btn.onclick = () => toggleTrevo(i);
                
                // Aplicar classe de trevo sorteado se necess√°rio
                if (trevosSorteados.has(i)) {
                    btn.classList.add('sorteado');
                }
                
                grid.appendChild(btn);
            }
            
            // Atualizar estado inicial
            atualizarEstadoTrevosSorteados();
        }

        // Atualizar estado dos n√∫meros sorteados
        function atualizarEstadoNumerosSorteados() {
            const permitir = document.getElementById('permitirNumerosSorteados').checked;
            
            numerosSorteados.forEach(numero => {
                const btn = document.querySelector(`#gridNumeros button:nth-child(${numero})`);
                if (btn) {
                    if (permitir) {
                        // Checkbox MARCADO: HABILITAR n√∫meros sorteados
                        btn.classList.remove('disabled');
                        btn.style.cursor = 'pointer';
                        btn.onclick = () => toggleNumero(numero);
                    } else {
                        // Checkbox DESMARCADO (padr√£o): DESABILITAR n√∫meros sorteados
                        btn.classList.add('disabled');
                        btn.style.cursor = 'not-allowed';
                        btn.onclick = () => {
                            mostrarModalNumeroSorteado(numero, 'n√∫mero');
                        };
                    }
                }
            });
        }

        // Atualizar estado dos trevos sorteados
        function atualizarEstadoTrevosSorteados() {
            const permitir = document.getElementById('permitirNumerosSorteados').checked;
            
            trevosSorteados.forEach(trevo => {
                const btn = document.querySelector(`#gridTrevos button:nth-child(${trevo})`);
                if (btn) {
                    if (permitir) {
                        // Checkbox MARCADO: HABILITAR trevos sorteados
                        btn.classList.remove('disabled');
                        btn.style.cursor = 'pointer';
                        btn.onclick = () => toggleTrevo(trevo);
                    } else {
                        // Checkbox DESMARCADO (padr√£o): DESABILITAR trevos sorteados
                        btn.classList.add('disabled');
                        btn.style.cursor = 'not-allowed';
                        btn.onclick = () => {
                            mostrarModalNumeroSorteado(trevo, 'trevo');
                        };
                    }
                }
            });
        }

        // Mostrar modal explicativo para n√∫mero/trevo sorteado
        function mostrarModalNumeroSorteado(valor, tipo) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            const icone = tipo === 'n√∫mero' ? 'üíé' : 'üçÄ';
            const texto = tipo === 'n√∫mero' ? `n√∫mero ${valor.toString().padStart(2, '0')}` : `trevo ${valor}`;
            
            modal.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <h3 class="font-bold text-orange-800 mb-2">${icone} ${tipo.charAt(0).toUpperCase() + tipo.slice(1)} Sorteado</h3>
                    <p class="text-gray-700 mb-4">O ${texto} saiu no √∫ltimo concurso. Marque "Permitir usar n√∫meros/trevos j√° sorteados" para inclu√≠-lo nos seus jogos.</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-2 bg-orange-500 text-white hover:bg-orange-600 rounded" onclick="this.closest('.fixed').remove()">Entendi</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Toggle sele√ß√£o de n√∫mero
        function toggleNumero(numero) {
            // Verificar se n√∫mero est√° bloqueado
            if (numerosSorteados.has(numero) && !document.getElementById('permitirNumerosSorteados').checked) {
                mostrarModalNumeroSorteado(numero, 'n√∫mero');
                return;
            }

            const btn = document.querySelector(`#gridNumeros button:nth-child(${numero})`);
            
            if (numerosSelecionados.includes(numero)) {
                // Remover n√∫mero
                numerosSelecionados = numerosSelecionados.filter(n => n !== numero);
                btn.classList.remove('selecionado');
            } else if (numerosSelecionados.length < quantidadeNumeros) {
                // Adicionar n√∫mero
                numerosSelecionados.push(numero);
                btn.classList.add('selecionado');
            }
            
            atualizarAnaliseJogo();
            validarBotaoAdicionar();
        }

        // Toggle sele√ß√£o de trevo
        function toggleTrevo(trevo) {
            // Verificar se trevo est√° bloqueado
            if (trevosSorteados.has(trevo) && !document.getElementById('permitirNumerosSorteados').checked) {
                mostrarModalNumeroSorteado(trevo, 'trevo');
                return;
            }

            const btn = document.querySelector(`#gridTrevos button:nth-child(${trevo})`);
            
            if (trevosSelecionados.includes(trevo)) {
                // Remover trevo
                trevosSelecionados = trevosSelecionados.filter(t => t !== trevo);
                btn.classList.remove('selecionado');
            } else if (trevosSelecionados.length < quantidadeTrevos) {
                // Adicionar trevo
                trevosSelecionados.push(trevo);
                btn.classList.add('selecionado');
            }
            
            atualizarAnaliseJogo();
            validarBotaoAdicionar();
        }

        // Atualizar an√°lise do jogo atual
        function atualizarAnaliseJogo() {
            document.getElementById('numerosCount').textContent = `${numerosSelecionados.length}/${quantidadeNumeros}`;
            document.getElementById('trevosCount').textContent = `${trevosSelecionados.length}/${quantidadeTrevos}`;
            
            // Calcular d√≠gitos diferentes (todos os d√≠gitos 0-9 que aparecem)
            const digitos = new Set();
            numerosSelecionados.forEach(num => {
                const numStr = num.toString().padStart(2, '0');
                // Adicionar cada d√≠gito individual
                for (let digit of numStr) {
                    digitos.add(parseInt(digit));
                }
            });
            
            document.getElementById('digitosCount').textContent = digitos.size;
            console.log(`Jogo atual: ${numerosSelecionados.map(n => n.toString().padStart(2, '0')).join(' ')} + trevos: ${trevosSelecionados.join(' ')} = ${digitos.size} d√≠gitos: ${Array.from(digitos).sort().join(' ')}`);
            atualizarSugestaoDigitos(digitos.size);
        }

        // Atualizar sugest√£o de d√≠gitos
        function atualizarSugestaoDigitos(digitosAtuais = 0) {
            const ultimoDigitos = window.digitosUltimoSorteio || 7;
            const sugestaoEl = document.getElementById('sugestaoDigitos');
            
            let sugestao = `√öltimo sorteio usou ${ultimoDigitos} d√≠gitos diferentes. `;
            
            if (digitosAtuais === 0) {
                sugestao += `Sugerimos: ${ultimoDigitos - 1} (pequeno), ${ultimoDigitos} (m√©dio) ou ${ultimoDigitos + 1} (alto).`;
            } else {
                if (digitosAtuais < ultimoDigitos - 1) {
                    sugestao += `Atual: ${digitosAtuais} (muito pequeno) üìâ`;
                } else if (digitosAtuais === ultimoDigitos - 1) {
                    sugestao += `Atual: ${digitosAtuais} (pequeno) ‚úÖ`;
                } else if (digitosAtuais === ultimoDigitos) {
                    sugestao += `Atual: ${digitosAtuais} (m√©dio) ‚úÖ`;
                } else if (digitosAtuais === ultimoDigitos + 1) {
                    sugestao += `Atual: ${digitosAtuais} (alto) ‚úÖ`;
                } else {
                    sugestao += `Atual: ${digitosAtuais} (muito alto) üìà`;
                }
            }
            
            sugestaoEl.textContent = sugestao;
        }

        // Validar bot√£o adicionar
        function validarBotaoAdicionar() {
            const btn = document.getElementById('adicionarJogo');
            btn.disabled = numerosSelecionados.length !== quantidadeNumeros || trevosSelecionados.length !== quantidadeTrevos;
        }

        // Configurar event listeners
        function configurarEventListeners() {
            // Controle de n√∫meros sorteados
            document.getElementById('permitirNumerosSorteados').addEventListener('change', () => {
                atualizarEstadoNumerosSorteados();
                atualizarEstadoTrevosSorteados();
            });

            // Bot√µes de a√ß√£o do jogo
            document.getElementById('limparJogo').addEventListener('click', limparSelecao);
            document.getElementById('randomizarJogo').addEventListener('click', randomizarJogo);
            document.getElementById('adicionarJogo').addEventListener('click', adicionarJogo);
            
            // Controles dos jogos
            document.getElementById('mostrarOrdemCrescente').addEventListener('change', atualizarVisualizacaoJogos);
            document.getElementById('limparTodos').addEventListener('click', limparTodosJogos);
            
            // Downloads
            document.getElementById('downloadHTML').addEventListener('click', () => downloadJogos('html'));
            document.getElementById('downloadTXT').addEventListener('click', () => downloadJogos('txt'));
            document.getElementById('downloadXLSX').addEventListener('click', () => downloadJogos('xlsx'));
            
            // Modal
            document.getElementById('comoFuncionaBtn').addEventListener('click', () => {
                document.getElementById('modalComoFunciona').classList.remove('hidden');
            });
            document.getElementById('fecharModal').addEventListener('click', () => {
                document.getElementById('modalComoFunciona').classList.add('hidden');
            });
        }

        // Limpar sele√ß√£o atual
        function limparSelecao() {
            numerosSelecionados = [];
            trevosSelecionados = [];
            document.querySelectorAll('.numero-milionaria').forEach(btn => {
                btn.classList.remove('selecionado');
            });
            document.querySelectorAll('.trevo-milionaria').forEach(btn => {
                btn.classList.remove('selecionado');
            });
            atualizarAnaliseJogo();
            validarBotaoAdicionar();
        }

        // Randomizar jogo respeitando n√∫meros e trevos sorteados
        function randomizarJogo() {
            limparSelecao();
            
            const permiteSorteados = document.getElementById('permitirNumerosSorteados').checked;
            
            // Randomizar n√∫meros
            let numerosDisponiveis = Array.from({length: 50}, (_, i) => i + 1);
            if (!permiteSorteados) {
                // Filtrar n√∫meros sorteados se n√£o permitidos
                numerosDisponiveis = numerosDisponiveis.filter(num => !numerosSorteados.has(num));
            }
            
            while (numerosSelecionados.length < quantidadeNumeros && numerosDisponiveis.length > 0) {
                const index = Math.floor(Math.random() * numerosDisponiveis.length);
                const numero = numerosDisponiveis.splice(index, 1)[0];
                numerosSelecionados.push(numero);
                
                const btn = document.querySelector(`#gridNumeros button:nth-child(${numero})`);
                btn.classList.add('selecionado');
            }

            // Randomizar trevos
            let trevosDisponiveis = Array.from({length: 6}, (_, i) => i + 1);
            if (!permiteSorteados) {
                // Filtrar trevos sorteados se n√£o permitidos
                trevosDisponiveis = trevosDisponiveis.filter(trevo => !trevosSorteados.has(trevo));
            }
            
            while (trevosSelecionados.length < quantidadeTrevos && trevosDisponiveis.length > 0) {
                const index = Math.floor(Math.random() * trevosDisponiveis.length);
                const trevo = trevosDisponiveis.splice(index, 1)[0];
                trevosSelecionados.push(trevo);
                
                const btn = document.querySelector(`#gridTrevos button:nth-child(${trevo})`);
                btn.classList.add('selecionado');
            }
            
            atualizarAnaliseJogo();
            validarBotaoAdicionar();
        }

        // Adicionar jogo √† lista
        function adicionarJogo() {
            if (numerosSelecionados.length !== quantidadeNumeros || trevosSelecionados.length !== quantidadeTrevos) return;
            
            const jogo = {
                id: Date.now(),
                numeros: [...numerosSelecionados].sort((a, b) => a - b),
                trevos: [...trevosSelecionados].sort((a, b) => a - b),
                custo: custoJogo,
                digitosDiferentes: (() => {
                    const digitos = new Set();
                    numerosSelecionados.forEach(num => {
                        const numStr = num.toString().padStart(2, '0');
                        for (let digit of numStr) {
                            digitos.add(parseInt(digit));
                        }
                    });
                    return digitos.size;
                })()
            };
            
            jogosAdicionados.push(jogo);
            limparSelecao();
            atualizarVisualizacaoJogos();
            atualizarCustoTotal();
        }

        // Atualizar visualiza√ß√£o dos jogos
        function atualizarVisualizacaoJogos() {
            const lista = document.getElementById('listaJogos');
            const ordemCrescente = document.getElementById('mostrarOrdemCrescente').checked;
            
            if (jogosAdicionados.length === 0) {
                lista.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhum jogo adicionado ainda</p>';
                return;
            }
            
            lista.innerHTML = '';
            jogosAdicionados.forEach((jogo, index) => {
                const jogoDiv = document.createElement('div');
                jogoDiv.className = 'jogo-card';
                
                const numerosOrdenados = ordemCrescente ? 
                    [...jogo.numeros].sort((a, b) => a - b) : 
                    jogo.numeros;

                const trevosOrdenados = ordemCrescente ? 
                    [...jogo.trevos].sort((a, b) => a - b) : 
                    jogo.trevos;
                
                jogoDiv.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-milionaria">Jogo ${index + 1}</span>
                        <div class="flex gap-2">
                            <span class="digito-badge">${jogo.digitosDiferentes} d√≠gitos</span>
                            <button onclick="removerJogo(${jogo.id})" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                    <div class="mb-2">
                        <div class="text-xs text-gray-600 mb-1">N√∫meros:</div>
                        <div class="flex flex-wrap gap-1">
                            ${numerosOrdenados.map(num => 
                                `<div class="numero-jogo">${num.toString().padStart(2, '0')}</div>`
                            ).join('')}
                        </div>
                    </div>
                    <div class="mb-2">
                        <div class="text-xs text-gray-600 mb-1">üçÄ Trevos:</div>
                        <div class="flex gap-1">
                            ${trevosOrdenados.map(trevo => 
                                `<div class="trevo-jogo">${trevo}</div>`
                            ).join('')}
                        </div>
                    </div>
                    <div class="text-sm text-gray-600">
                        6 n√∫meros + 2 trevos - ${formatarMoeda(jogo.custo)}
                    </div>
                `;
                
                lista.appendChild(jogoDiv);
            });
        }

        // Remover jogo espec√≠fico
        function removerJogo(id) {
            jogosAdicionados = jogosAdicionados.filter(jogo => jogo.id !== id);
            atualizarVisualizacaoJogos();
            atualizarCustoTotal();
        }

        // Limpar todos os jogos
        function limparTodosJogos() {
            if (jogosAdicionados.length === 0) return;
            
            // Modal customizado ao inv√©s de confirm()
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 mb-4">Tem certeza que deseja remover todos os jogos?</p>
                    <div class="flex justify-end space-x-3">
                        <button id="cancelarLimpar" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">Cancelar</button>
                        <button id="confirmarLimpar" class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded">Confirmar</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            document.getElementById('cancelarLimpar').onclick = () => {
                document.body.removeChild(modal);
            };
            document.getElementById('confirmarLimpar').onclick = () => {
                jogosAdicionados = [];
                atualizarVisualizacaoJogos();
                atualizarCustoTotal();
                document.body.removeChild(modal);
            };
        }

        // Atualizar custo total
        function atualizarCustoTotal() {
            const total = jogosAdicionados.length * custoJogo;
            document.getElementById('custoTotal').textContent = formatarMoeda(total);
            document.getElementById('totalJogos').textContent = jogosAdicionados.length;
        }

        // Formatar valor monet√°rio
        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }

        // Downloads
        function downloadJogos(formato) {
            if (jogosAdicionados.length === 0) {
                // Modal customizado ao inv√©s de alert()
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                        <p class="text-gray-700 mb-4">Adicione pelo menos um jogo antes de fazer o download!</p>
                        <div class="flex justify-end">
                            <button class="px-4 py-2 bg-blue-500 text-white hover:bg-blue-600 rounded" onclick="this.closest('.fixed').remove()">OK</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                return;
            }
            
            const jogosOrdenados = jogosAdicionados.map(jogo => ({
                ...jogo,
                numeros: [...jogo.numeros].sort((a, b) => a - b),
                trevos: [...jogo.trevos].sort((a, b) => a - b)
            }));
            
            switch (formato) {
                case 'html':
                    downloadHTML(jogosOrdenados);
                    break;
                case 'txt':
                    downloadTXT(jogosOrdenados);
                    break;
                case 'xlsx':
                    downloadXLSX(jogosOrdenados);
                    break;
            }
        }

        // Download HTML
        function downloadHTML(jogos) {
            const total = jogos.length * custoJogo;
            const data = new Date().toLocaleDateString('pt-BR');
            
            let html = `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>+Milion√°ria - Meus Jogos</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { text-align: center; margin-bottom: 30px; color: white; background: #31357C; padding: 20px; border-radius: 10px; }
        .jogo { margin: 10px 0; padding: 15px; border: 2px solid #31357C; border-radius: 8px; }
        .numero { display: inline-block; width: 30px; height: 30px; background: #31357C; color: white; 
                 border-radius: 50%; text-align: center; line-height: 30px; margin: 2px; font-weight: bold; font-size: 12px; }
        .trevo { display: inline-block; width: 30px; height: 30px; background: #10b981; color: white; 
                border-radius: 6px; text-align: center; line-height: 30px; margin: 2px; font-weight: bold; font-size: 12px; }
        .total { text-align: center; margin-top: 20px; font-size: 18px; font-weight: bold; color: #31357C; }
        .secao { margin: 10px 0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üíé +MILION√ÅRIA - MEUS JOGOS</h1>
        <p>Gerado em: ${data}</p>
    </div>`;
            
            jogos.forEach((jogo, index) => {
                html += `
    <div class="jogo">
        <h3>Jogo ${index + 1} - 6 n√∫meros + 2 trevos - ${formatarMoeda(jogo.custo)}</h3>
        <div class="secao">
            <strong>N√∫meros:</strong><br>
            ${jogo.numeros.map(num => `<span class="numero">${num.toString().padStart(2, '0')}</span>`).join('')}
        </div>
        <div class="secao">
            <strong>üçÄ Trevos:</strong><br>
            ${jogo.trevos.map(trevo => `<span class="trevo">${trevo}</span>`).join('')}
        </div>
        <p><small>${jogo.digitosDiferentes} d√≠gitos diferentes</small></p>
    </div>`;
            });
            
            html += `
    <div class="total">
        Total: ${jogos.length} jogo(s) - ${formatarMoeda(total)}
    </div>
</body>
</html>`;
            
            baixarArquivo(html, 'mais-milionaria-jogos.html', 'text/html');
        }

        // Download TXT - Somente n√∫meros
        function downloadTXT(jogos) {
            let txt = '';
            
            jogos.forEach((jogo, index) => {
                txt += jogo.numeros.map(n => n.toString().padStart(2, '0')).join(' ');
                if (index < jogos.length - 1) {
                    txt += '\n';
                }
            });
            
            baixarArquivo(txt, 'mais-milionaria-jogos.txt', 'text/plain');
        }

        // Download XLSX
        function downloadXLSX(jogos) {
            const dados = [
                ['Jogo', 'N√∫meros', 'Trevos', 'D√≠gitos Diferentes', 'Custo']
            ];
            
            jogos.forEach((jogo, index) => {
                dados.push([
                    `Jogo ${index + 1}`,
                    jogo.numeros.map(n => n.toString().padStart(2, '0')).join(' - '),
                    jogo.trevos.join(' - '),
                    jogo.digitosDiferentes,
                    jogo.custo
                ]);
            });
            
            const total = jogos.length * custoJogo;
            dados.push(['', 'TOTAL:', '', jogos.length + ' jogo(s)', total]);
            
            const ws = XLSX.utils.aoa_to_sheet(dados);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, '+Milion√°ria');
            XLSX.writeFile(wb, 'mais-milionaria-jogos.xlsx');
        }

        // Fun√ß√£o auxiliar para baixar arquivo
        function baixarArquivo(conteudo, nomeArquivo, tipoMime) {
            const blob = new Blob([conteudo], { type: tipoMime });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = nomeArquivo;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>